receivers:
  # Scrape RabbitMQ Prometheus metrics
  prometheus:
    config:
      scrape_configs:
        - job_name: 'rabbitmq'
          scrape_interval: 15s
          static_configs:
            - targets: ['rabbitmq:15692']
          metric_relabel_configs:
            # Add service.name label to all RabbitMQ metrics
            - source_labels: [__name__]
              target_label: service_name
              replacement: 'rabbitmq'

processors:
  # Add resource attributes to identify metrics source
  resource:
    attributes:
      - key: service.name
        value: rabbitmq
        action: upsert

  # Batch metrics for efficiency
  batch:
    timeout: 10s
    send_batch_size: 1024

exporters:
  # Forward to ClickStack OTLP endpoint
  otlp:
    endpoint: clickstack:4317
    tls:
      insecure: true
    headers:
      authorization: ${OTEL_AUTHORIZATION}

  # Logging for debugging (optional)
  logging:
    verbosity: detailed
    sampling_initial: 5
    sampling_thereafter: 200

service:
  pipelines:
    metrics:
      receivers: [prometheus]
      processors: [resource, batch]
      exporters: [otlp, logging]
